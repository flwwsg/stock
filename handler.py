# -*- coding: utf-8 -*-
import pandas as pd
from pandas import Series
from pandas.tseries.offsets import BDay
import tushare as ts


def count_stocks(labels, stocks):
    nlist = []
    exists = []
    reserved = []
    for label, stock in zip(labels, stocks):
        nlist.extend(stock.keys())

    scount = Series(nlist).value_counts()
    print(scount[:20])
    res = scount[:50].index
    endtime = pd.datetime.today()
    starttime = endtime - BDay(7)
    starttime = starttime.strftime('%Y-%m-%d')
    endtime = endtime.strftime('%Y-%m-%d')

    for i in res:
        hist = ts.get_hist_data(code=i, start=starttime, end=endtime)
        # print(hist)
        # print(i)
        apped = True
        if hist is not None:
            l = len(hist)
            if hist['close'].mean() < 21 and l > 5:
                for j in range(1, 4):
                    test = hist['close'][j] < hist['close'][j - 1] or abs(hist['close'][j] - hist['close'][j - 1]) < 1 
                    if not test:
                        apped = False
                        break
                if apped:
                    reserved.append(i[-6:])

    print(reserved)
    return reserved


if __name__ == '__main__':
    s1 = ['创金合信鑫收', '金鹰核心资源', '易方达新兴成', '交银新生活力', '华润元大安鑫', '汇添富社会责', '农银策略精选', '万家新兴蓝筹', '农银行业领先', '金鹰策略配置', '农银汇理国企', '宝盈互联网沪', '交银经济新动', '广发创新升级', '中银中小盘成', '宝盈鸿利收益', '交银定期支付', '中融物联网主', '万家品质', '交银先进制造', '交银稳健配置', '易方达科讯混', '国联安红利混', '银华盛世精选', '华商新趋势优', '上投摩根新兴', '华安媒体互联', '富国创新科技', '富国高新技术', '富国天瑞强势', '交银阿尔法核', '博时外延增长', '宝盈科技30', '申万菱信新能', '国投瑞银核心', '信诚中小盘混', '东方红产业升', '银华中小盘混', '信诚深度价值', '银华领先策略', '易方达创新驱', '易方达改革红', '富国天益价值', '华富价值增长', '长盛电子信息', '博时产业新动', '上投摩根中小', '长信双利优选', '万家和谐增长', '申万菱信消费']
    s2 = [{'sh601939': '建设银行', 'sh600016': '民生银行', 'sh600816': '安信信托', 'sh601601': '中国太保', 'sh601166': '兴业银行', 'sz000001': '平安银行', 'sz002142': '宁波银行', 'sh601398': '工商银行', 'sh601988': '中国银行', 'sz000830': '鲁西化工'}, {'sz300607': '拓斯达', 'sz300623': '捷捷微电', 'sh600879': '航天电子', 'sz300568': '星源材质', 'sz002833': '弘亚数控', 'sz300503': '昊志机电', 'sh603197': '保隆科技', 'sz300595': '欧普康视', 'sz002829': '星网宇达', 'sz300567': '精测电子'}, {'sz300078': '思创医惠', 'sz002460': '赣锋锂业', 'sh601012': '隆基股份', 'sz300346': '南大光电', 'sz300068': '南都电源', 'sz002466': '天齐锂业', 'sz300383': '光环新网', 'sz002530': '金财互联', 'sz300015': '爱尔眼科', 'sz002365': '永安药业'}, {'sh600885': '宏发股份', 'sz002008': '大族激光', 'sz002045': '国光电器', 'sh600703': '三安光电', 'sz300347': '泰格医药', 'sz300308': '中际装备', 'sz002460': '赣锋锂业', 'sh600258': '首旅酒店', 'sz300115': '长盈精密', 'sz002583': '海能达'}, {'sz002241': '歌尔股份', 'sh600030': '中信证券', 'sh603799': '华友钴业', 'sh601318': '中国平安', 'sz002008': '大族激光', 'sz000725': '京东方A', 'sh600519': '贵州茅台', 'sz000063': '中兴通讯', 'sz002236': '大华股份', 'sz000651': '格力电器'}, {'sz300340': '科恒股份', 'sz300450': '先导智能', 'sz002475': '立讯精密', 'sz002236': '大华股份', 'sz002175': '东方网络', 'sz002466': '天齐锂业', 'sh600884': '杉杉股份', 'sz002273': '水晶光电', 'sh603799': '华友钴业', 'sh603869': '北部湾旅'}, {'sz002624': '完美世界', 'sh601607': '上海医药', 'sh603179': '新泉股份', 'sh600779': '水井坊', 'sz000858': '五粮液', 'sh600519': '贵州茅台', 'sh600593': '大连圣亚', 'sz000568': '泸州老窖', 'sh603589': '口子窖', 'sz002555': '三七互娱'}, {'sz002636': '金安国纪', 'sh600110': '诺德股份', 'sz300073': '当升科技', 'sz002460': '赣锋锂业', 'sh600340': '华夏幸福', 'sh600183': '生益科技', 'sz002108': '沧州明珠', 'sz001979': '招商蛇口', 'sz002466': '天齐锂业', 'sh600884': '杉杉股份'}, {'sz002624': '完美世界', 'sh601607': '上海医药', 'sh603179': '新泉股份', 'sh600779': '水井坊', 'sz000858': '五粮液', 'sh600519': '贵州茅台', 'sh600593': '大连圣亚', 'sz000568': '泸州老窖', 'sh603589': '口子窖', 'sz002555': '三七互娱'}, {'sz002206': '海利得', 'sh603989': '艾华集团', 'sz300415': '伊之密', 'sz300232': '洲明科技', 'sz002583': '海能达', 'sz002466': '天齐锂业', 'sz000596': '古井贡酒', 'sz002230': '科大讯飞', 'sz300203': '聚光科技', 'sz002127': '南极电商'}, {'sz002624': '完美世界', 'sh601607': '上海医药', 'sh603179': '新泉股份', 'sh600779': '水井坊', 'sz000858': '五粮液', 'sh600519': '贵州茅台', 'sh600593': '大连圣亚', 'sz000568': '泸州老窖', 'sh603589': '口子窖', 'sz002555': '三七互娱'}, {'': '瑞声科技', 'sz300450': '先导智能', 'sz002050': '三花智控', 'sz300083': '劲胜智能', 'sz300308': '中际装备', 'sz002833': '弘亚数控', 'sz300613': '富瀚微', 'sz300567': '精测电子', 'sz002831': '裕同科技'}, {'sz002202': '金风科技', 'sz002045': '国光电器', 'sh600030': '中信证券', 'sh600036': '招商银行', 'sz300308': '中际装备', 'sh600500': '中化国际', 'sh600967': '内蒙一机', 'sz300129': '泰胜风能', 'sh601398': '工商银行', 'sh601688': '华泰证券'}, {'sh600276': '恒瑞医药', 'sh600516': '方大炭素', 'sh601933': '永辉超市', 'sh600188': '兖州煤业', 'sh600036': '招商银行', 'sz001979': '招商蛇口', 'sz002024': '苏宁云商', 'sz000513': '丽珠集团', 'sh600643': '爱建集团', 'sz002508': '老板电器'}, {'sh601689': '拓普集团', 'sz300450': '先导智能', 'sz300083': '劲胜智能', 'sh600138': '中青旅', 'sz000915': '山大华特', 'sh603355': '莱克电气', 'sz002460': '赣锋锂业', 'sz300616': '尚品宅配', 'sz002517': '恺英网络', 'sh601155': '新城控股'}, {'sh600885': '宏发股份', 'sz300450': '先导智能', 'sh603556': '海兴电力', 'sz300083': '劲胜智能', 'sz300463': '迈克生物', 'sh603816': '顾家家居', 'sz300097': '智云股份', 'sz002833': '弘亚数控', 'sh600176': '中国巨石', 'sz300316': '晶盛机电'}, {'sh600885': '宏发股份', 'sh600693': '东百集团', 'sz002045': '国光电器', 'sh600703': '三安光电', 'sz000821': '京山轻机', 'sz002583': '海能达', 'sh600258': '首旅酒店', 'sz002460': '赣锋锂业', 'sz300115': '长盈精密', 'sz300308': '中际装备'}, {'sz300323': '华灿光电', 'sz300450': '先导智能', 'sz300408': '三环集团', 'sz002460': '赣锋锂业', 'sh600477': '杭萧钢构', 'sz002466': '天齐锂业', 'sz002635': '安洁科技', 'sz000063': '中兴通讯', 'sz300577': '开润股份', 'sz002008': '大族激光'}, {'sh600110': '诺德股份', 'sz300073': '当升科技', 'sz002460': '赣锋锂业', 'sh600340': '华夏幸福', 'sh600183': '生益科技', 'sh600338': '西藏珠峰', 'sz001979': '招商蛇口', 'sz002466': '天齐锂业', 'sh600884': '杉杉股份', 'sz002024': '苏宁云商'}, {'sz002202': '金风科技', 'sh600499': '科达洁能', 'sz002045': '国光电器', 'sh600030': '中信证券', 'sz300308': '中际装备', 'sh600500': '中化国际', 'sh600967': '内蒙一机', 'sz300129': '泰胜风能', 'sh601688': '华泰证券', 'sz300161': '华中数控'}, {'sh601933': '永辉超市', 'sz002271': '东方雨虹', 'sz000538': '云南白药', 'sh601012': '隆基股份', 'sh600258': '首旅酒店', 'sh600622': '嘉宝集团', 'sh600519': '贵州茅台', 'sz000333': '美的集团', 'sh601607': '上海医药', 'sh600056': '中国医药'}, {'sz300033': '同花顺', 'sz002230': '科大讯飞', 'sh601012': '隆基股份', 'sz300113': '顺网科技', 'sz300068': '南都电源', 'sz002466': '天齐锂业', 'sz300015': '爱尔眼科', 'sz002530': '金财互联', 'sz300383': '光环新网', 'sh600763': '通策医疗'}, {'sz300450': '先导智能', 'sh600699': '均胜电子', 'sz300232': '洲明科技', 'sh603799': '华友钴业', 'sz002766': '索菱股份', 'sz002466': '天齐锂业', 'sz002460': '赣锋锂业', 'sz002236': '大华股份', 'sz002530': '金财互联', 'sz002508': '老板电器'}, {'sz300274': '阳光电源', 'sz000997': '新大陆', 'sh603898': '好莱客', 'sz000858': '五粮液', 'sz002640': '跨境通', 'sz300013': '新宁物流', 'sz300021': '大禹节水', 'sz002831': '裕同科技', 'sz000651': '格力电器', 'sz000568': '泸州老窖'}, {'sh600998': '九州通', 'sz000925': '众合科技', 'sz300324': '旋极信息', 'sh600079': '人福医药', 'sz002581': '未名医药', 'sz300142': '沃森生物', 'sz002188': '巴士在线', 'sh600015': '华夏银行', 'sh600029': '南方航空', 'sh601111': '中国国航'}, {'sz300340': '科恒股份', 'sz002456': '欧菲光', 'sz002460': '赣锋锂业', 'sz002008': '大族激光', 'sz002466': '天齐锂业', 'sz300115': '长盈精密', 'sz300136': '信维通信', 'sh600406': '国电南瑞', 'sz002236': '大华股份', 'sz002411': '必康股份'}, {'sz300619': '金银河', 'sh600360': '华微电子', 'sz002185': '华天科技', 'sz300007': '汉威科技', 'sh600030': '中信证券', 'sz300365': '恒华科技', 'sz000662': '天夏智慧', 'sh600549': '厦门钨业', 'sh601688': '华泰证券', 'sh600603': '广汇物流'}, {'sz002475': '立讯精密', 'sz002456': '欧菲光', 'sz002050': '三花智控', 'sh600703': '三安光电', 'sh603078': '江化微', 'sz002008': '大族激光', 'sz002466': '天齐锂业', 'sz300136': '信维通信', 'sz300595': '欧普康视', 'sh600066': '宇通客车'}, {'sz300065': '海兰信', 'sz300197': '铁汉生态', 'sz002456': '欧菲光', 'sz300595': '欧普康视', 'sz002460': '赣锋锂业', 'sh600703': '三安光电', 'sz002466': '天齐锂业', 'sh600066': '宇通客车', 'sh603078': '江化微', 'sh600487': '亨通光电'}, {'sz300335': '迪森股份', 'sz002456': '欧菲光', 'sh601607': '上海医药', 'sh601318': '中国平安', 'sh600563': '法拉电子', 'sh600622': '嘉宝集团', 'sz000915': '山大华特', 'sh601988': '中国银行', 'sh601398': '工商银行', 'sz002635': '安洁科技'}, {'sz002343': '慈文传媒', 'sz002045': '国光电器', 'sz300365': '恒华科技', 'sh600054': '黄山旅游', 'sz300308': '中际装备', 'sz300347': '泰格医药', 'sz002027': '分众传媒', 'sh600967': '内蒙一机', 'sz002195': '二三四五', 'sh603868': '飞科电器'}, {'sh600566': '济川药业', 'sh600337': '美克家居', 'sz300463': '迈克生物', 'sz002450': '康得新', 'sz002396': '星网锐捷', 'sh600887': '伊利股份', 'sz000881': '中广核技', 'sz002139': '拓邦股份', 'sh603337': '杰克股份', 'sz300124': '汇川技术'}, {'sz300450': '先导智能', 'sz002456': '欧菲光', 'sz002833': '弘亚数控', 'sz300367': '东方网力', 'sz002773': '康弘药业', 'sz300308': '中际装备', 'sz300252': '金信诺', 'sz300097': '智云股份', 'sz002273': '水晶光电', 'sz300567': '精测电子'}, {'sh600885': '宏发股份', 'sz002050': '三花智控', 'sz002594': '比亚迪', 'sz002466': '天齐锂业', 'sz002008': '大族激光', 'sh600884': '杉杉股份', 'sh600066': '宇通客车', 'sz300124': '汇川技术', 'sh603799': '华友钴业', 'sh600104': '上汽集团'}, {'sz300340': '科恒股份', 'sz002368': '太极股份', 'sh600038': '中直股份', 'sh600110': '诺德股份', 'sh600739': '辽宁成大', 'sz002466': '天齐锂业', 'sh600884': '杉杉股份', 'sz000997': '新大陆', 'sh603799': '华友钴业', 'sz002340': '格林美'}, {'sz002241': '歌尔股份', 'sz000669': '金鸿控股', 'sz002475': '立讯精密', 'sz300068': '南都电源', 'sz000921': '海信科龙', 'sz002415': '海康威视', 'sz300237': '美晨科技', 'sz002008': '大族激光', 'sz000811': '烟台冰轮', 'sz002217': '合力泰'}, {'sh600426': '华鲁恒升', 'sz300408': '三环集团', 'sh601318': '中国平安', 'sz300166': '东方国信', 'sz002470': '金正大', 'sh600887': '伊利股份', 'sz000333': '美的集团', 'sh600297': '广汇汽车', 'sz002311': '海大集团', 'sh600066': '宇通客车'}, {'sz300274': '阳光电源', 'sz000967': '盈峰环境', 'sh603898': '好莱客', 'sz000858': '五粮液', 'sz300115': '长盈精密', 'sz300013': '新宁物流', 'sz300021': '大禹节水', 'sz002831': '裕同科技', 'sz000651': '格力电器', 'sz000568': '泸州老窖'}, {'sh601211': '国泰君安', 'sh600048': '保利地产', 'sh601607': '上海医药', 'sz000921': '海信科龙', 'sz300068': '南都电源', 'sh600519': '贵州茅台', 'sh600612': '老凤祥', 'sh600872': '中炬高新', 'sz000651': '格力电器', 'sh600104': '上汽集团'}, {'sh600809': '山西汾酒', 'sz300274': '阳光电源', 'sz002640': '跨境通', 'sz002567': '唐人神', 'sz000967': '盈峰环境', 'sh600535': '天士力', 'sz000858': '五粮液', 'sh600021': '上海电力', 'sz300021': '大禹节水', 'sz000568': '泸州老窖'}, {'sz300182': '捷成股份', 'sz300222': '科大智能', 'sh603989': '艾华集团', 'sh600074': '保千里', 'sz300054': '鼎龙股份', 'sz002583': '海能达', 'sz002434': '万里扬', 'sz300098': '高新兴', 'sz300393': '中来股份', 'sz000711': '京蓝科技'}, {'sh600519': '贵州茅台', 'sz002019': '亿帆医药', 'sh601012': '隆基股份', 'sh600779': '水井坊', 'sz000858': '五粮液', 'sz002008': '大族激光', 'sz002043': '兔宝宝', 'sz300393': '中来股份', 'sz000651': '格力电器', 'sz000568': '泸州老窖'}, {'sh600031': '三一重工', 'sz002366': '台海核电', 'sz002153': '石基信息', 'sz002694': '顾地科技', 'sh600309': '万华化学', 'sh600519': '贵州茅台', 'sz000581': '威孚高科', 'sz002142': '宁波银行', 'sz300070': '碧水源', 'sz002271': '东方雨虹'}, {'sh600750': '江中药业', 'sh603588': '高能环境', 'sz002665': '首航节能', 'sz000597': '东北制药', 'sz002466': '天齐锂业', 'sz002439': '启明星辰', 'sz000823': '超声电子', 'sz300567': '精测电子', 'sh603939': '益丰药房', 'sz002325': '洪涛股份'}, {'sh603888': '新华网', 'sz000938': '紫光股份', 'sz000997': '新大陆', 'sh600845': '宝信软件', 'sz002354': '天神娱乐', 'sz300383': '光环新网', 'sz002049': '紫光国芯', 'sh600487': '亨通光电', 'sz000063': '中兴通讯', 'sz300017': '网宿科技'}, {'sh600566': '济川药业', 'sh600337': '美克家居', 'sz300463': '迈克生物', 'sz002450': '康得新', 'sz002396': '星网锐捷', 'sh600887': '伊利股份', 'sz000881': '中广核技', 'sz002139': '拓邦股份', 'sh603337': '杰克股份', 'sz300124': '汇川技术'}, {'sh603626': '科森科技', 'sz002456': '欧菲光', 'sz002241': '歌尔股份', 'sz002460': '赣锋锂业', 'sz002008': '大族激光', 'sz002466': '天齐锂业', 'sz300115': '长盈精密', 'sz300136': '信维通信', 'sh600406': '国电南瑞', 'sz002411': '必康股份'}, {'sh601689': '拓普集团', 'sh601377': '兴业证券', 'sh601933': '永辉超市', 'sz002007': '华兰生物', 'sh601633': '长城汽车', 'sh600622': '嘉宝集团', 'sh600110': '诺德股份', 'sh600309': '万华化学', 'sh603589': '口子窖', 'sz002043': '兔宝宝'}, {'sz002636': '金安国纪', 'sh600110': '诺德股份', 'sh600338': '西藏珠峰', 'sz002460': '赣锋锂业', 'sh600340': '华夏幸福', 'sh600183': '生益科技', 'sh601997': '贵阳银行', 'sz001979': '招商蛇口', 'sz002466': '天齐锂业', 'sh600884': '杉杉股份'}, {'sz002475': '立讯精密', 'sz002271': '东方雨虹', 'sh600779': '水井坊', 'sh601601': '中国太保', 'sz002635': '安洁科技', 'sz000568': '泸州老窖', 'sz002572': '索菲亚', 'sz002236': '大华股份', 'sz000651': '格力电器', 'sz002508': '老板电器'}]


    count_stocks(s1, s2)
